<!DOCTYPE html>
<html lang="en">
<body>
    {% include 'header.html' %}
    <main>
    <h1 class="center-container title">Closet</h1>
    <center>
        <a href="add_clothing_camera" class="action-button">Add Clothing: Camera</a>
        <a href="add_clothing_manual" class="action-button">Add Clothing: Manual</a>
    </center>
    </br>
    <div class="dropdown">
        <button class="action-button" onclick="toggleDropdown()" class="article-filter">Article</button>
        <div id="article-filter" class="dropdown-content">
            <label>Jacket<input type="checkbox" class="filterCheckbox" value="Jacket"></label>
            <label>T-Shirt<input type="checkbox" class="filterCheckbox" value="T-Shirt"></label>
            <label>Sweatshirt<input type="checkbox" class="filterCheckbox" value="Sweatshirt"></label>
            <label>Pants<input type="checkbox" class="filterCheckbox" value="Pants"></label>
            <label>Shorts<input type="checkbox" class="filterCheckbox" value="Shorts"></label>
            <label>Shoes<input type="checkbox" class="filterCheckbox" value="Shoes"></label>
            <label>Hat<input type="checkbox" class="filterCheckbox" value="Hat"></label>
            <button class="action-button" onclick="applyFilters()">Apply</button>
        </div>
    </div>
    <div class="grid">
        {% for clothing_name, file_path, clothes_id, is_clean in clothes %}
            <div class="grid-item center text" data-clothes-id="{{ clothes_id }}">
                <p class="text-over-image" onclick="makeEditable(this)">{{ clothing_name }}</p>
                <img class="grid-image" src="{{ url_for('static', filename=file_path) }}" alt="{{ clothing_name }} Image">
                <button class="delete-button" onclick="deleteClothing('{{ clothes_id }}')">Delete Clothing</button>
                <button class="cleanliness-button" onclick="toggleCleanliness('{{ clothes_id }}', this)">{{ 'Clean' if is_clean else 'Dirty' }}</button>
            </div>
        {% endfor %}
    
        <script>
            function toggleCleanliness(clothesId, button) {
                var currentStatus = button.innerText.trim();
                var newStatus = currentStatus === 'Clean' ? 'Dirty' : 'Clean';
                
                button.innerText = newStatus;

                fetch('/update_cleanliness', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        clothesId: clothesId,
                        cleanlinessStatus: newStatus
                    })
                })
                .then(response => {
                    if (response.ok) {
                    } else {
                        throw new Error('Failed to update cleanliness status');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    button.innerText = currentStatus;
                });
            }

            function makeEditable(element) {
                element.contentEditable = true;
                element.focus();
    
                const clothingName = element.innerText.trim(); // Extract clothing name from the clicked element
    
                element.addEventListener('focusout', function () {
                    const updatedText = element.innerText.trim();
    
                    updateBackend(updatedText, clothingName);
                    element.contentEditable = false;
                });
            }
    
            function updateBackend(updatedText, identifier) {
                fetch('/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ updatedText, identifier }),
                })
                    .then(response => {
                        if (response.ok) {
                            return response.json();
                        }
                        throw new Error('Network response was not ok.');
                    })
                    .then(data => {
                        console.log('Updated successfully:', data);
                    })
                    .catch(error => {
                        console.error('Error updating:', error);
                    });
            }
            
            function deleteClothing(clothes_id) {
                fetch('/delete', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ clothes_id }),
                })
                .then(response => {
                    if (response.ok) {
                        console.log('Clothing deleted successfully');
                        const gridItems = document.querySelectorAll('.grid-item');
                        gridItems.forEach(gridItem => {
                            const dataClothesId = gridItem.getAttribute('data-clothes-id');
                            if (dataClothesId === clothes_id) {
                                gridItem.remove();
                            }
                        });
                    } else {
                        throw new Error('Network response was not ok.');
                    }
                })
                .catch(error => {
                    console.error('Error deleting clothing:', error);
                });
            }

            function toggleDropdown() {
                var dropdown = document.getElementById("article-filter")
                dropdown.classList.toggle("show")
            }

            function applyFilters() {
                var checkboxes = document.querySelectorAll('.filterCheckbox');
                var selectedFilters = Array.from(checkboxes)
                    .filter(checkbox => checkbox.checked)
                    .map(checkbox => checkbox.value);

                // Perform actions with selectedFilters (e.g., filter data, etc.)
                console.log("Selected Filters: ", selectedFilters);

                // Hide the dropdown after applying filters
                document.getElementById("filterDropdown").classList.remove("show");
                }
        </script>
    </div>
    </main>
</body>
</html>
